

# اللعب المتعدد عبر شبكة الواي فاي المحلية (بدون إنترنت)

## الفكرة العامة
سنستخدم تقنية **WebRTC** للاتصال المباشر بين جهازين على نفس شبكة الواي فاي بدون الحاجة لإنترنت. سيتبادل اللاعبون **رمز اتصال قصير** (يقوله أحدهم للآخر أو يُنسخ) لإنشاء الاتصال.

## كيف يعمل الاتصال؟
1. **اللاعب 1** يضغط "إنشاء غرفة" - يظهر له رمز (كود) على الشاشة
2. **اللاعب 2** يضغط "انضمام" ويكتب الرمز - يظهر له رمز ثاني
3. **اللاعب 1** يكتب الرمز الثاني
4. يتصل الجهازان مباشرة ويبدأ اللعب!

```text
+-------------+          رمز 1          +-------------+
|  اللاعب 1   | ----------------------> |  اللاعب 2   |
|  (المضيف)   | <---------------------- |  (الضيف)    |
+-------------+          رمز 2          +-------------+
        |                                       |
        +----------- WebRTC مباشر --------------+
                  (بيانات اللعبة)
```

## التغييرات المطلوبة

### 1. إنشاء hook للاتصال المباشر (`src/hooks/useP2PConnection.ts`)
- إدارة WebRTC peer connection و data channel
- توليد وضغط رموز الاتصال (offer/answer) لتكون قصيرة قدر الإمكان
- إرسال واستقبال حالة اللعبة كرسائل JSON
- التعامل مع قطع الاتصال وإعادة المحاولة

### 2. إنشاء واجهة غرفة اللعب (`src/components/MultiplayerLobby.tsx`)
- شاشة اختيار: "إنشاء غرفة" أو "انضمام لغرفة"
- عرض الرمز مع زر نسخ
- حقل إدخال لكتابة رمز الطرف الآخر
- مؤشر حالة الاتصال (جاري الاتصال / متصل / فشل)

### 3. إنشاء hook لمزامنة حالة اللعبة (`src/hooks/useMultiplayerSync.ts`)
- مزامنة حالة اللوحة بين الجهازين
- تحديد من يلعب ومن ينتظر
- التعامل مع تأخر الشبكة

### 4. تعديل كل لعبة لدعم وضع اللعب عبر الشبكة

**XO (`src/pages/XOGame.tsx`):**
- إضافة وضع "لاعب عبر الشبكة" في الإعدادات
- اللاعب 1 يلعب X واللاعب 2 يلعب O
- كل لاعب يرى اللوحة ويتفاعل في دوره فقط

**شطرنج (`src/pages/ChessGame.tsx`):**
- إضافة وضع "لاعب عبر الشبكة"
- اللاعب المضيف = أبيض، الضيف = أسود
- مزامنة حركات الشطرنج عبر FEN أو notation

**لودو (`src/pages/LudoGame.tsx`):**
- إضافة وضع "لاعب عبر الشبكة" (2 لاعبين)
- مزامنة رمي النرد وحركات القطع
- المضيف يتحكم بمنطق اللعبة ويرسل النتائج

### 5. تعديل الصفحة الرئيسية
- عدم تغيير في التصميم، فقط الأوضاع الجديدة تظهر في إعدادات كل لعبة

## ملاحظات تقنية مهمة

- **رموز الاتصال**: ستكون SDP offers/answers مضغوطة. قد تكون طويلة نسبيا (50-100 حرف) لكنها قابلة للنسخ واللصق
- **يعمل بدون إنترنت**: WebRTC يعمل مباشرة بين الأجهزة على نفس الشبكة المحلية
- **لا يحتاج سيرفر**: لا حاجة لأي خدمة خارجية
- **القيد الوحيد**: يجب أن يكون الجهازان على نفس شبكة الواي فاي
- **STUN server**: عادة WebRTC يحتاج STUN server للاكتشاف، لكن على الشبكة المحلية يمكن استخدام عناوين IP المحلية مباشرة. سنضيف STUN كـ fallback اختياري (يعمل إذا كان هناك إنترنت)

## ترتيب التنفيذ
1. إنشاء `useP2PConnection` hook
2. إنشاء `MultiplayerLobby` component  
3. إنشاء `useMultiplayerSync` hook
4. تعديل XO (الأسهل للاختبار)
5. تعديل شطرنج
6. تعديل لودو

